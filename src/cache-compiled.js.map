{"version":3,"sources":["cache.js"],"names":[],"mappings":"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","file":"cache-compiled.js","sourcesContent":["//cache.sj\n/**\n * Created by David Breuer on 15/12/15.\n *\n * @file cache.sj\n * @description\n *\n */\n'use strict';\n\nvar fs = require('fs-extra');\nvar path = require('path');\nvar os = require('os');\nvar _ = require('lodash');\nvar basedir = require('xdg-basedir');\n\nvar C = require('./constants');\nvar UserError = require('./error/UserError');\n\n////////\n\nvar cache = module.exports = {};\n\n// store cache in memory for current run\nvar tmp;\n\n////////\n\ncache.set = function (path, value) {\n    var data = load();\n    _.set(data, path, value);\n    save(data);\n};\n\ncache.get = function (path, defaultValue) {\n    var data = load();\n    var value = _.get(data, path);\n    return _.isUndefined(value) ? defaultValue : value;\n};\n\ncache.remove = function (path) {\n    var data = load();\n\n    var parts = path.split('.');\n    if (parts.length > 1) {\n\n        var key = parts.pop();\n        var parentPath = parts.join('.');\n        var parent = _.get(data, parentPath);\n\n        delete parent[key];\n\n    } else {\n\n        delete data[path];\n\n    }\n\n    save(data);\n};\n\ncache.path = function () {\n    var basePath = basedir.cache || os.tempdir();\n    var cachePath = path.join(basePath, C.CACHE_DIR_NAME, C.CACHE_FILE_NAME);\n    return cachePath;\n};\n\n////////\n\nfunction load() {\n    if (tmp) {\n        return tmp;\n    }\n\n    var serialized = '';\n    try {\n        serialized = fs.readFileSync(cache.path(), 'utf8');\n    } catch(err) {\n        // it's fine if cache file does not exist, it will be created on save\n        if (err.code !== 'ENOENT') {\n            throw new Error(err);\n        }\n    }\n\n    var data = {};\n    try {\n        data = JSON.parse(serialized);\n    } catch (err) {}\n\n    tmp = data;\n\n    return data;\n}\n\nfunction save(data) {\n    var serialized = '';\n    try {\n        serialized = JSON.stringify(data);\n    } catch (err) {}\n\n    tmp = data;\n\n    var cachePath = cache.path();\n    var cacheDir = path.dirname(cachePath);\n\n    try {\n        fs.mkdirsSync(cacheDir);\n        fs.writeFileSync(cachePath, serialized, 'utf8');\n    } catch (err) {\n        if (err.code === 'EACCES') {\n            throw new UserError('Not enough permissions to write cache.', err);\n        }\n    }\n}"]}